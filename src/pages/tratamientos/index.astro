---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Nav from '../../components/Nav.astro';
import Footer from '../../components/Footer.astro';
import { Picture } from "astro:assets";
import content from "../../data/content.json";
import { getCollection } from "astro:content";

const services = await getCollection("services");
const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/images/*.{png,jpg,jpeg,webp}', { eager: true });
const waPhone = content.company.phone.replace(/[^0-9]/g, "");
---

<BaseLayout 
    title="Masajes Terapéuticos y Terapias Naturales en Monzón"
    description="Consulta mi carta de masajes en Monzón: masaje muscular, antiestrés, piedras calientes y más. Tratamientos personalizados para tu salud física y emocional."
>
    <Nav />
    
    <main class="pt-32 pb-20 px-6">
        <div class="text-center max-w-3xl mx-auto mb-16">
            <h1 class="text-teal-600 font-sans font-medium tracking-widest uppercase text-sm">Carta de Bienestar</h1>
            <h2 class="text-5xl font-serif text-gray-800 mt-4 mb-6">Tratamientos <span class="holographic-text normal-case">holísticos</span></h2>
            <p class="text-gray-500 font-light text-lg">
                Elige la terapia que tu cuerpo necesita hoy. Todas las sesiones se personalizan según tu estado físico y emocional del momento.
            </p>
        </div>

        <section class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
            {services.map((service, index) => {
                 const imageSrc = images[`/src/assets/images/${service.data.image}`]?.default;
                 return (
                <a href={`/tratamientos/${service.slug}`} class="glass-panel p-1 rounded-3xl flex flex-col md:flex-row overflow-hidden group hover:shadow-md transition-all">
                    <!-- Image Side -->
                    <div class="w-full md:w-2/5 relative h-64 md:h-auto overflow-hidden rounded-2xl md:rounded-l-2xl md:rounded-r-none">
                         {imageSrc && (
                            <Picture 
                                src={imageSrc} 
                                alt={service.data.image_alt || service.data.title} 
                                formats={['avif', 'webp']}
                                widths={[400, 800]}
                                sizes="(max-width: 768px) 100vw, 400px"
                                loading={index === 0 ? "eager" : "lazy"}
                                fetchpriority={index === 0 ? "high" : "auto"}
                                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" 
                            />
                         )}
                         <!-- Overlay -->
                         <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
                    </div>
                    
                    <!-- Content Side -->
                    <div class="w-full md:w-3/5 p-8 flex flex-col justify-center">
                        <h3 class="text-2xl font-serif text-gray-800 group-hover:text-teal-600 transition-colors mb-2">{service.data.title}</h3>

                        <p class="text-gray-600 font-light mb-6 flex-grow line-clamp-4">
                            {service.body}
                        </p>
                        
                        <div class="flex gap-4 mt-auto">
                            <span class="inline-flex items-center text-sm font-medium text-teal-600 group-hover:text-lilac-600 transition-colors">
                                Ver detalles
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                                </svg>
                            </span>
                        </div>
                    </div>
                </a>
            )})}
        </section>
    </main>

    <Footer />
</BaseLayout>
