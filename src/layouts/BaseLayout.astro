---
import "../styles/global.css";
// Import fonts directly to allow Astro to optimize their loading
import "@fontsource/outfit/300.css";
import "@fontsource/outfit/400.css";
import "@fontsource/outfit/500.css";
import "@fontsource/outfit/600.css";
import "@fontsource/montserrat/300.css";
import "@fontsource/montserrat/400.css";
import "@fontsource/montserrat/500.css";
import "@fontsource/montserrat/600.css";

// Preload the most critical fonts for instant discovery
import outfit300 from "@fontsource/outfit/files/outfit-latin-300-normal.woff2?url";
import outfit400 from "@fontsource/outfit/files/outfit-latin-400-normal.woff2?url";
import outfit500 from "@fontsource/outfit/files/outfit-latin-500-normal.woff2?url";
import montserrat600 from "@fontsource/montserrat/files/montserrat-latin-600-normal.woff2?url";

import WhatsAppButton from "../components/WhatsAppButton.astro";
import { ClientRouter } from "astro:transitions";

interface Props {
	title: string;
	description?: string;
	image?: string;
}

const {
	title,
	description = "Masajista y Terapeuta Holística - Cristina Murciano",
	image = "/og-image.jpg",
} = Astro.props;
---

<!doctype html>
<html lang="es" class="scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
		<meta name="description" content={description} />
		<link rel="canonical" href={Astro.url} />

		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website" />
		<meta property="og:url" content={Astro.url} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={new URL(image, Astro.url)} />

		<!-- Preload critical fonts -->
		<link
			rel="preload"
			href={outfit300}
			as="font"
			type="font/woff2"
			crossorigin
		/>
		<link
			rel="preload"
			href={outfit500}
			as="font"
			type="font/woff2"
			crossorigin
		/>
		<link
			rel="preload"
			href={montserrat600}
			as="font"
			type="font/woff2"
			crossorigin
		/>

		<!-- Local Business Schema -->
		<script is:inline type="application/ld+json">
			{
				"@context": "https://schema.org",
				"@type": "LocalBusiness",
				"name": "Cristina Murciano",
				"image": "https://cristinamurciano.es/og-image.jpg",
				"@id": "https://cristinamurciano.es",
				"url": "https://cristinamurciano.es",
				"telephone": "+34696049698",
				"address": {
					"@type": "PostalAddress",
					"streetAddress": "Plaza María Moliner 14",
					"addressLocality": "Monzón",
					"postalCode": "22400",
					"addressRegion": "Huesca",
					"addressCountry": "ES"
				},
				"geo": {
					"@type": "GeoCoordinates",
					"latitude": 41.908,
					"longitude": 0.1903
				},
				"openingHoursSpecification": {
					"@type": "OpeningHoursSpecification",
					"dayOfWeek": [
						"Monday",
						"Tuesday",
						"Wednesday",
						"Thursday",
						"Friday"
					],
					"opens": "09:00",
					"closes": "20:00"
				},
				"sameAs": [
					"https://www.facebook.com/Cristina-Murciano-139",
					"https://www.instagram.com/cristinamurcianosanchez/"
				]
			}
		</script>
		<ClientRouter />
	</head>
	<body
		class="bg-gradient-to-br from-white to-lilac-100/30 min-h-screen relative"
	>
		<!-- Texture Overlay -->
		<div
			class="fixed inset-0 z-50 pointer-events-none opacity-[0.03] mix-blend-multiply"
			style="background-image: url('data:image/svg+xml,%3Csvg viewBox=\'0 0 200 200\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cfilter id=\'noiseFilter\'%3E%3CfeTurbulence type=\'fractalNoise\' baseFrequency=\'0.65\' numOctaves=\'3\' stitchTiles=\'stitch\'/%3E%3C/filter%3E%3Crect width=\'100%25\' height=\'100%25\' filter=\'url(%23noiseFilter)\'/%3E%3C/svg%3E');"
		>
		</div>

		<!-- Ambient Background Lights -->
		<div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
			<div
				class="absolute top-[-10%] left-[-10%] w-[70%] h-[70%] bg-teal-200/30 rounded-full blur-[120px] mix-blend-multiply animate-float"
			>
			</div>
			<div
				class="absolute bottom-[-10%] right-[-10%] w-[70%] h-[70%] bg-lilac-200/30 rounded-full blur-[120px] mix-blend-multiply animate-float"
				style="animation-delay: 2s;"
			>
			</div>
		</div>

		<slot />
		<WhatsAppButton />

		<script>
			function initReveal() {
				// Feature detection for CSS scroll-driven animations
				// If the browser supports them, we don't need the JS fallback
				const supportsScrollTimeline = CSS.supports(
					"animation-timeline",
					"scroll()",
				);

				if (supportsScrollTimeline) {
					// Optionally cleanup existing reveal-js classes if re-running
					document
						.querySelectorAll(".reveal")
						.forEach((el) => el.classList.remove("reveal-js"));
					return;
				}

				const observerOptions = {
					root: null,
					rootMargin: "0px",
					threshold: 0.1,
				};

				const observer = new IntersectionObserver((entries) => {
					entries.forEach((entry) => {
						if (entry.isIntersecting) {
							entry.target.classList.add("active");
						}
					});
				}, observerOptions);

				const revealElements = document.querySelectorAll(".reveal");
				revealElements.forEach((el) => {
					el.classList.add("reveal-js");
					observer.observe(el);
				});
			}

			// Initialize on first load
			initReveal();

			// Re-initialize after view transitions
			document.addEventListener("astro:page-load", initReveal);
		</script>
	</body>
</html>
