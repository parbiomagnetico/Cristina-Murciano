---
import { Picture } from "astro:assets";
import content from "../data/content.json";
import logo from "../assets/images/logo.png";

const links = content.navigation;
const waPhone = content.company.phone.replace(/[^0-9]/g, "");
---

<header class="fixed top-0 left-0 w-full z-50 flex justify-center pt-6 px-4">
    <nav
        class="glass-panel rounded-full px-8 py-3 flex items-center justify-between gap-8 max-w-4xl w-full relative z-[60]"
    >
        <a href="/" class="group flex items-center gap-2">
            <Picture
                src={logo}
                alt="Cristina Murciano Logo"
                formats={["avif", "webp"]}
                widths={[100, 200]}
                sizes="100px"
                class="h-12 w-auto object-contain hover:scale-105 transition-transform"
            />
            <span class="sr-only">Cristina Murciano</span>
        </a>

        <div class="hidden md:flex items-center gap-8">
            {
                links.map((link) => (
                    <a
                        href={link.href}
                        class="relative text-sm uppercase tracking-widest text-gray-600 hover:text-teal-600 font-medium transition-colors group py-2"
                    >
                        {link.name}
                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-teal-400 to-lilac-400 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-center" />
                    </a>
                ))
            }
        </div>

        <a
            href={`https://wa.me/${waPhone}`}
            target="_blank"
            rel="noopener noreferrer"
            class="hidden md:block bg-teal-200/50 hover:bg-teal-200/80 text-teal-900 px-5 py-2 rounded-full text-sm font-medium transition-all backdrop-blur-sm"
        >
            Reservar
        </a>

        <!-- Mobile Menu Button -->
        <button
            id="mobile-menu-button"
            class="md:hidden text-gray-700 p-2 rounded-full hover:bg-white/50 transition-all active:scale-95"
            aria-label="MenÃº"
        >
            <div
                class="w-6 h-5 relative flex flex-col justify-between overflow-hidden"
            >
                <span
                    id="line-1"
                    class="w-full h-0.5 bg-current transition-all duration-300 origin-left"
                ></span>
                <span
                    id="line-2"
                    class="w-full h-0.5 bg-current transition-all duration-300"
                ></span>
                <span
                    id="line-3"
                    class="w-full h-0.5 bg-current transition-all duration-300 origin-left"
                ></span>
            </div>
        </button>
    </nav>

    <!-- Full Mobile Menu Overlay -->
    <div
        id="mobile-menu-overlay"
        class="fixed inset-0 z-50 bg-white/95 backdrop-blur-2xl flex flex-col items-center justify-center transform translate-y-[-100%] transition-transform duration-500 ease-in-out md:hidden pointer-events-none"
    >
        <div class="flex flex-col items-center gap-8">
            {
                links.map((link) => (
                    <a
                        href={link.href}
                        class="mobile-link text-3xl font-serif text-gray-800 hover:text-teal-600 transition-all opacity-0 translate-y-4"
                    >
                        {link.name}
                    </a>
                ))
            }
            <a
                href={`https://wa.me/${waPhone}`}
                target="_blank"
                rel="noopener noreferrer"
                class="mobile-link bg-teal-600 text-white px-10 py-4 rounded-full text-xl font-medium shadow-xl shadow-teal-900/10 opacity-0 translate-y-4"
            >
                Reservar
            </a>
        </div>
    </div>
</header>

<script>
    function setupMenu() {
        const button = document.getElementById(
            "mobile-menu-button",
        ) as HTMLElement;
        const overlay = document.getElementById(
            "mobile-menu-overlay",
        ) as HTMLElement;
        const line1 = document.getElementById("line-1") as HTMLElement;
        const line2 = document.getElementById("line-2") as HTMLElement;
        const line3 = document.getElementById("line-3") as HTMLElement;
        const links = document.querySelectorAll(".mobile-link");

        if (!button || !overlay || !line1 || !line2 || !line3) return;

        let isOpen = false;

        const toggle = () => {
            isOpen = !isOpen;

            if (isOpen) {
                overlay.classList.remove(
                    "translate-y-[-100%]",
                    "pointer-events-none",
                );
                overlay.classList.add("translate-y-0", "pointer-events-auto");

                // Animate hamburger to X
                line1.style.transform = "rotate(45deg) translate(2px, -1px)";
                line2.style.opacity = "0";
                line2.style.transform = "translateX(20px)";
                line3.style.transform = "rotate(-45deg) translate(2px, 1px)";

                document.body.style.overflow = "hidden";

                // Animate links
                links.forEach((link, i) => {
                    setTimeout(
                        () => {
                            link.classList.remove("opacity-0", "translate-y-4");
                            link.classList.add("opacity-100", "translate-y-0");
                        },
                        200 + i * 100,
                    );
                });
            } else {
                overlay.classList.add(
                    "translate-y-[-100%]",
                    "pointer-events-none",
                );
                overlay.classList.remove(
                    "translate-y-0",
                    "pointer-events-auto",
                );

                // Reset hamburger
                line1.style.transform = "none";
                line2.style.opacity = "1";
                line2.style.transform = "none";
                line3.style.transform = "none";

                document.body.style.overflow = "";

                // Reset links animations for next time
                links.forEach((link) => {
                    link.classList.add("opacity-0", "translate-y-4");
                    link.classList.remove("opacity-100", "translate-y-0");
                });
            }
        };

        button.addEventListener("click", toggle);

        // Close on link click
        links.forEach((link) => {
            link.addEventListener("click", () => {
                if (isOpen) toggle();
            });
        });

        // Cleanup on destroy (for View Transitions)
        return () => {
            button.removeEventListener("click", toggle);
            document.body.style.overflow = "";
        };
    }

    // Initialize
    let cleanup = setupMenu();

    // Support Astro View Transitions
    document.addEventListener("astro:before-swap", () => {
        if (cleanup) cleanup();
    });
    document.addEventListener("astro:after-swap", () => {
        cleanup = setupMenu();
    });
</script>
